# 项目优化方向建议

在完成「安全与合规」六项及界面优化后，对当前项目做了一次完整审查。以下为可选的优化方向，**请您勾选或补充希望优先落地的项**，再按优先级实施。

---

## 一、RAG 与检索增强

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| R1 | **查询意图分类** | 在检索前用轻量模型或规则区分：事实问答 / 摘要 / 列表 / 无关闲聊，从而选择是否走 RAG、是否扩写 query。 | 中 |
| R2 | **多路召回策略可配置** | 当前向量 + BM25 + RRF 已实现；可做成按知识库配置「仅向量 / 仅全文 / 混合 / 权重」，并在前端展示。 | 小 |
| R3 | **检索结果缓存** | 对相同/相似 query 的 embedding 或检索结果做短期缓存（如 Redis），降低向量库与 LLM 压力。 | 中 |
| R4 | **分块策略增强** | 支持按标题/段落语义切分（如 llama_parse、语义分块），而不仅是固定长度；可选「表格/列表」单独成块。 | 中 |
| R5 | **引用与溯源增强** | 回答中标注来源 chunk 的页码、文件名、段落号；支持「点击引用跳转到原文」的前端展示。 | 小 |

---

## 二、NER 与实体能力

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| N1 | **入库前实体抽取** | 在写入知识库前对文本做 NER（人名、组织、地点、时间、产品等），将实体写入 chunk 的 metadata 或独立表，便于按实体筛选/检索。 | 中 |
| N2 | **检索阶段实体过滤** | 用户问「张三负责的项目」时，先抽问句中的实体，再在向量检索时带实体过滤条件，提升精准度。 | 中 |
| N3 | **实体库与实体卡片** | 维护「实体—出现 chunk」的索引；前端提供「实体列表 / 实体详情页」，展示该实体在哪些文档中出现、摘要。 | 大 |
| N4 | **与脱敏联动** | 当前已有敏感信息脱敏；可与 NER 结合：对识别出的敏感实体做脱敏或打标，避免进入向量或回答。 | 小 |

---

## 三、MCP 接入与调用

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| M1 | **MCP Server 端** | 将当前能力暴露为 MCP Server：如「知识库检索」「文件列表」「问答」等作为 Tools，供外部 MCP Client（如 Claude Desktop、其他 Agent）调用。 | 大 |
| M2 | **MCP Client 端** | 在 RAG 或 Agent 中作为「工具调用」：调用外部 MCP 工具（如查数据库、调 API、读文件），把结果纳入上下文再生成回答。 | 大 |
| M3 | **MCP 工具管理后台** | 前端配置「已接入的 MCP 服务 / 工具列表」、启用禁用、简单测试；后端做工具发现、参数校验与调用代理。 | 中 |

---

## 四、Agent 与多 Agent

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| A1 | **单 Agent + 工具调用** | 在现有 RAG 对话上增加「工具」：如查知识库、搜图、查用量、执行 MCP 工具；LLM 决定何时调哪个工具，后端执行并回填上下文。 | 大 |
| A2 | **规划与拆解** | Agent 先对用户问题进行规划（拆子问题、选知识库、选工具），再按步骤执行检索/工具调用，最后综合生成回答。 | 大 |
| A3 | **多 Agent 协作** | 引入「路由 Agent + 专业 Agent」：路由负责意图分发；检索 Agent、计算 Agent、外部 API Agent 等各司其职，结果汇总后由协调 Agent 生成最终回复。 | 很大 |
| A4 | **对话记忆与摘要** | 长对话的上下文用「滑动窗口 + 历史摘要」或向量化历史要点，控制 token 同时保留关键信息，便于 Agent 做多轮决策。 | 中 |

---

## 五、工程与可观测性

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| E1 | **健康检查增强** | `/health` 增加对 MySQL、Redis、向量库（Zilliz/Qdrant）、MinIO、可选 LLM 连通性的检测，返回各依赖状态。 | 小 |
| E2 | **结构化日志与请求 ID** | 关键路径打结构化日志（含 request_id、user_id、kb_id）；便于排查与链路追踪。 | 小 |
| E3 | **耗时与用量统计** | 记录每次检索/生成的耗时、token 数、向量条数；写入 usage 或独立表，用于计费与性能分析。 | 中 |
| E4 | **限流与熔断** | 对 LLM/向量/外部 API 调用做限流与简单熔断，防止下游故障拖垮服务。 | 中 |
| E5 | **单元测试与集成测试** | 为 core 服务（embedding、vector_store、chat_service 关键路径）补 pytest；CI 中跑核心用例。 | 中 |

---

## 六、前端与体验

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| F1 | **统一请求方式** | 聊天流式、知识库添加文件流式、文件下载等尽量统一走 axios 或封装后的 fetch，便于统一错误处理与 token 刷新。 | 小 |
| F2 | **错误边界与加载态** | 关键页面（Chat、KnowledgeBases、ImageSearch）增加 Error Boundary 与骨架屏/加载态，避免白屏。 | 小 |
| F3 | **引用来源可点击** | 回答中的来源展示为可点击，跳转到对应知识库/文件/分块或新开预览。 | 小 |
| F4 | **暗色模式** | 在现有 AI 风格基础上增加暗色主题切换，存用户偏好。 | 小 |
| F5 | **移动端适配** | 侧栏与表格在小屏下可折叠、列表适配触摸，便于移动端使用。 | 中 |

---

## 七、其他扩展

| 序号 | 方向 | 说明 | 工作量 |
|------|------|------|--------|
| O1 | **多租户 / 组织** | 支持「组织—知识库—成员」模型，知识库归属组织，成员权限可配置（仅读、可编辑等）。 | 大 |
| O2 | **API Key 与开放接口** | 除 JWT 外支持 API Key 调用，便于脚本、第三方集成；可选速率限制与 Key 管理页。 | 中 |
| O3 | **文档解析增强** | 接入更专业解析（如 Unstructured、LlamaParse）提升 PDF/表格/版式复杂文档的抽取质量。 | 中 |
| O4 | **多模型切换** | 前端/知识库级别选择 Embedding 模型与 LLM 模型（当前部分支持）；统一模型列表与计费展示。 | 小 |

---

## 建议的优先级参考（供勾选）

- **快速见效**：R5 引用增强、E1 健康检查、F1 统一请求、F2 错误边界、O4 多模型切换  
- **能力升级**：N1/N2 实体、A1 单 Agent+工具、M1 MCP Server  
- **中长期**：A3 多 Agent、M2 MCP Client、O1 多租户  

请您在下方或单独回复中标注：**希望优先做哪些序号**（如 R1、N1、M1、A1、E1、F3、O2），或补充新的方向，我会按您的选择给出实施顺序和拆解任务。
