## 多模型 RAG 系统后续优化方向与落地方案

### 1. 智能问答 & 对话体验

- **更细粒度的「模式路由」**
  - 当前主要是「是否启用 RAG / 工具」两种开关，可以引入更细粒度的「模式路由」：
    - 纯闲聊 / 头脑风暴 → 小上下文、低成本模型；
    - 结构化问答（表格、人事、财务）→ 强约束 JSON 输出 + 校验；
    - 检索型问答 → 自动选择哪些知识库、是否用多轮追问。
  - 结合 LangChain，可用「Router Chain」或简单分类 prompt，把用户问题路由到不同链路。

- **结构化输出 & 业务表单**
  - 对部分场景（如生成周报、风险排查表、工单）要求 LLM 输出严格 JSON / YAML。
  - 后端对 JSON / YAML 做 schema 校验，前端渲染为表单或卡片，而不是纯文本。
  - 在现有 `ChatResponse` schema 之外，为「结构化任务」增加单独的 API 与前端 UI。

- **上下文记忆与用户画像**
  - 目前对话历史按会话 ID 存储，可新增「长期记忆」与「用户画像」（兴趣、角色、偏好），供问答和推荐使用。
  - 落地方式：
    - 新建存储「记忆」的表，在特定类型对话结束时写入；
    - 问答前用轻量 RAG 检索用户画像片段，注入 system prompt。

### 2. RAG 检索能力

- **分层 / 分角色检索**
  - 目前已有 BM25 + Embedding + Rerank，可以进一步拆分为：
    - 粗排：BM25 / 向量检索；
    - 精排：大模型 Rerank（已具备）+ 按「可信度」动态调整回答策略（例如置信度低时，多向用户澄清）。

- **更智能的切块（Chunking）与文档理解**
  - 针对 PPT / 报表 / 代码类文档，引入结构化解析：
    - 幻灯片按页 + 标题层级；
    - 表格按行/列摘要；
    - 代码按函数/类切分。
  - 检索时优先返回这些「结构单元」，提升回答精准度与可解释性。

- **跨知识库与跨模态聚合**
  - 在现有「全知识库检索」基础上，继续扩展：
    - 同时在文本库 + 图片库中检索，再统一 Rerank；
    - 同一问题下给出「文本证据 + 配图/截图」作为回答支撑。

### 3. Agent / 工具生态

- **.skill 生态升级**
  - 目前 `.skill` 主要是说明文档 + 手工映射，可进一步扩展为：
    - Skill 目录中支持「依赖声明」（其他工具、外部 API、前置验证逻辑）；
    - Skill 版本管理与启停（yaml 或 json 元数据 + md 文档）；
    - 在前端提供「技能中心」页面，用于浏览 / 启用 / 配置技能。

- **MCP 工具与企业内部服务联动**
  - 已接入 MCP 的基础上，可进一步为常用企业系统（Jira、飞书机器人、内部审批系统等）编写 MCP Server，统一纳入「工具层」。
  - 在 UI 上展示「当前可用外部工具列表」，并允许按会话维度开启/关闭工具。

- **多 Agent 协作模式**
  - 目前浏览器助手 / 电脑管家为单 Agent，可增加多 Agent 协作：
    - 「规划 Agent」负责拆解任务，分发给「浏览器 Agent」「知识库 Agent」「电脑管家 Agent」；
    - 最终由「裁决 Agent」合并结果，形成最终答案或操作计划。
  - 初期可用简单的「调用顺序模板」实现，不必急于引入复杂的 LangGraph。

### 4. 自动化与 Computer Use

- **电脑管家高级策略**
  - 目前电脑管家以「视觉 + 键鼠原子操作」为主，可增强为：
    - 针对浏览器、VS Code、Office 等常见应用，提供「高阶宏」：将打开 / 保存 / 查找 / 替换等序列封装为 `.skill`；
    - 提供「安全沙箱模式」：仅允许在指定窗口或虚拟桌面执行，避免误操作整个系统。

- **跨 Browser Assistant 与 电脑管家的任务编排**
  - 浏览器助手（Playwright）适合网页自动化，电脑管家适合桌面自动化，可以做统一编排：
    - 某些任务先由浏览器助手登录网页，再由电脑管家在桌面客户端继续操作；
    - 前端提供一个「自动化任务看板」，展示每一步来自哪个 Agent、执行了什么操作。

### 5. 监控、评估与调优

- **对话质量评估与 A/B 测试**
  - 利用 LLM 自评或专用打分模型，对回答自动评价（相关性、完整性、安全性），结果写入审计/日志表。
  - 支持「模型 / Prompt A/B」：
    - 同一个问题在后台走两条链路；
    - 比较质量与延迟，用于持续调优。

- **Tracing 与观测**
  - 在已有日志与审计基础上，进一步：
    - 按「请求 ID」整合 RAG 检索、工具调用、模型日志；
    - 接入 LangSmith 或类似 tracing 平台，查看各步骤链路、token 消耗与延迟分布。

### 6. 多租户 & 权限 / 安全

- **多租户隔离与配额策略**
  - 在当前计费 / 限流机制上增强：
    - 支持租户级别的模型配置（每个企业可选用自己的 LLM / 向量库 / 工具白名单）；
    - 支持更细粒度的配额：按「角色」或「部门」设置每日提问上限、RAG 调用上限等。

- **合规与审计强化**
  - 对敏感操作（电脑管家控制桌面、浏览器助手登录系统）记录更详细的审计信息：
    - 操作步骤；
    - 截图 hash；
    - 工具参数。
  - 增加「敏感字段掩码策略」配置界面，让管理员能自定义与调整脱敏规则。

### 7. 产品层面的增强场景

- **模板化场景工作台**
  - 如「投标书助手」「法务合同审查」「运维告警排查」「数据分析问答」等典型场景，可提供预置模板：
    - 固定的 System Prompt；
    - 自动选定的知识库 + 工具集；
    - 特定的 UI 与输出格式（例如：结论 + 证据列表）。

- **知识库运营工具**
  - 文档质量评分：
    - 使用 LLM 对知识库文档做「可读性 / 完整性」打分；
    - 给出改进建议，辅助知识库运营。
  - 失效知识检测：
    - 统计被频繁提问但置信度低的问题；
    - 提示需要补充或更新文档的位置。

