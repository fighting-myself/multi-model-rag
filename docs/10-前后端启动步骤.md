# 前后端启动步骤

## 一、环境要求

- **后端**：Python 3.11+，已配置好项目根目录的 `.env`
- **前端**：Node.js 18+

---

## 二、后端启动

在**项目根目录**已存在 `.env` 的前提下，任选一种方式。

### 方式 1：本机直接跑（推荐）

**第一次**需要先装依赖，之后只需执行启动命令。

```bash
cd e:\code\multi-model-rag\backend
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

- 后端会读取**项目根目录**的 `.env`（`e:\code\multi-model-rag\.env`）。
- 启动成功后：
  - API：http://localhost:8000
  - 文档：http://localhost:8000/docs

### 方式 2：从项目根目录跑（同样读根目录 .env）

```bash
cd e:\code\multi-model-rag
set PYTHONPATH=backend
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

（Linux/macOS 把 `set PYTHONPATH=backend` 换成 `export PYTHONPATH=backend`。）

### 方式 3：Docker 只跑后端

```bash
cd e:\code\multi-model-rag
docker-compose -f docker-compose.local.yml up -d --build
```

访问同上，日志：`docker-compose -f docker-compose.local.yml logs -f backend`。

---

## 三、前端启动

**第一次**需要先装依赖，之后只需执行启动命令。

```bash
cd e:\code\multi-model-rag\frontend
npm install
npm run dev
```

- 前端默认跑在：http://localhost:3000（见 `vite.config.ts` 的 `server.port`）。
- 请求会通过 Vite 代理：`/api` → `http://localhost:8000`，所以前端访问 `/api/v1/...` 即访问后端。

---

## 四、推荐启动顺序（本地开发）

1. **先启后端**（保证 8000 端口可用）  
   ```bash
   cd e:\code\multi-model-rag\backend
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```
2. **再启前端**（新开一个终端）  
   ```bash
   cd e:\code\multi-model-rag\frontend
   npm run dev
   ```
3. 浏览器打开前端地址（如 http://localhost:3000），即可使用；登录/接口都会走本机 8000 端口的后端。

---

## 五、Celery Worker（后台任务，可选）

使用「添加文件（后台）」「重新索引（后台）」等异步功能时，需要**单独启动 Celery Worker**，否则任务会一直处于 PENDING。

```bash
cd e:\code\multi-model-rag\backend
celery -A app.celery_app worker -l info --pool=solo
```

- 项目已把默认并发设为 **2**（避免容器/小内存机器因 128 进程被 OOM Killed）。如需更多并发可加：`--concurrency=4`。
- 需保证 Redis 已启动且 `.env` 中 `REDIS_URL`（或 Celery 的 broker/backend）可连。
- 以 root 运行会看到 SecurityWarning，生产环境建议用 `--uid` 指定非 root 用户。

---

## 六、常用命令速查

| 操作         | 命令 |
|--------------|------|
| 启后端       | `cd backend` → `uvicorn app.main:app --reload --host 0.0.0.0 --port 8000` |
| 启前端       | `cd frontend` → `npm run dev` |
| 启 Celery    | `cd backend` → `celery -A app.celery_app worker -l info --pool=solo`（后台任务用） |
| 后端依赖     | `cd backend` → `pip install -r requirements.txt` |
| 前端依赖     | `cd frontend` → `npm install` |
| 后端 API     | http://localhost:8000 |
| API 文档     | http://localhost:8000/docs |
| 前端页面     | http://localhost:3000（以 vite 配置为准） |
